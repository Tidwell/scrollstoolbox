"use strict";angular.module("scrollstoolboxApp",[]).config(["$routeProvider","$locationProvider",function(a,b){b.html5Mode(!0),a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/account",{templateUrl:"views/account.html",controller:"AccountCtrl"}).when("/forgot-password",{templateUrl:"views/forgot-password.html",controller:"ForgotPasswordCtrl"}).when("/links",{templateUrl:"views/links.html",controller:"LinksCtrl"}).when("/faq",{templateUrl:"views/faq.html",controller:"FaqCtrl"}).when("/collection",{templateUrl:"views/collection.html",controller:"CollectionCtrl"}).when("/wtswtb",{templateUrl:"views/wtswtb.html",controller:"WtswtbCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("scrollstoolboxApp").controller("MainCtrl",function(){}),angular.module("scrollstoolboxApp").controller("LinksCtrl",["$scope",function(a){a.links={prices:[{title:"Scrolls Trading Bulletin",url:"http://trading.scrolls.pw/",description:"Price checking and card information, generated from in-game bot"},{title:"Scrolls PC",url:"http://scrollspc.com/",description:"Price checking, price voting, historical price charts"},{title:"Scrolls Prices",url:"http://scrollsprices.com/",description:"Price checking"}],trading:[{title:"Scrolls Swap",url:"http://scrollswap.com/",description:"Post buy/sell/trade requests"},{title:"FastTrade",url:"http://scrollspc.com/fasttrade/index.php",description:"Made by ScrollsPC, post buy/sell requests"},{title:"TradingScrolls",url:"http://www.tradingscrolls.com/",description:"Post buy/sell/trade requests"}],deckbuilders:[{title:"Scrolls Guide Deckbuilder",url:"http://www.scrollsguide.com/deckbuilder/",description:"Sorting, Drag and Drop, Card Browser, Filters, Saving (account required)"},{title:"Famous Frames Deckbuilder",url:"http://scrolls.famousframes.de/",description:"Sorting, Search, Card Browser, Full-Card Visual Deckview, Sharing & Saving, Decks Browser, Commenting"}],official:[],fansites:[],lists:[{title:"Scrolls Guide Wiki Database",url:"http://www.scrollsguide.com/wiki/index.php/Scrolls_Database",description:"Browse all cards, Sorting, includes removed and upcomming cards."},{title:"Scrolls.Me Library",url:"http://library.scrolls.me/",description:"Browse all cards, Filters"},{title:"Visual Card Spoiler",url:"http://www.morosanmihail.com/home/scrolls-cards",description:"Browse images of all cards, Filters"}],misc:[{title:"Scrolls Guide Card Maker",url:"http://www.scrollsguide.com/designer",description:"Create custom cards"}],developers:[{title:"ScrollsGuide API",url:"http://www.reddit.com/r/Scrolls/comments/1ge2wj/full_scrolls_sqldb_or_spreatsheet/caje1f3",description:"Reddit thread for how to request ScrollsGuide API acess"},{title:"Scrolls Trading Bulletin API",url:"http://www.reddit.com/r/Scrolls/comments/1gqzg9/scrolls_trading_sites_comparisonaverage_in_json/can6dge",description:"Reddit thread detailing Scrolls Trading Bulletin API"}]}}]),angular.module("scrollstoolboxApp").controller("NavCtrl",["$scope","$location","user","socket",function(a,b,c,d){function e(){a.username="",a.password=""}a.user=c.get(),a.username="",a.password="",a.$watch("user.authed",function(){a.user.authed&&e()}),d.on("user:updated",function(){a.userUpdated=!0}),a.clearUpdated=function(){a.userUpdated=!1},a.login=function(){a.user=c.login({username:a.username,password:a.password})},a.register=function(){a.user=c.register({username:a.username,password:a.password})},a.logout=function(){a.user=c.logout()},a.navClass=function(a){var c=b.path().substring(1)||"home";return a===c?"active":""}}]),angular.module("scrollstoolboxApp").service("user",["$http","$rootScope","socket",function(a,b,c){function d(a){for(var b in a)f[b]=a[b]}var e={error:!1,authed:!1},f=angular.copy(e);return c.on("user:error",function(a){f.error=a.error}),c.on("user:registered",d),c.on("user:updated",d),c.on("user:login",d),{get:function(){return f},login:function(a){return f.error=!1,c.emit("user:login",a),f},register:function(a){return f.error=!1,c.emit("user:register",a),f},forgotPassword:function(a){return c.emit("user:forgot-password",{email:a}),f},logout:function(){return c.emit("user:logout",{username:f.username}),f.username="",f.authed=!1,f},update:function(){c.emit("user:update",{inGameName:f.inGameName,email:f.email,username:f.username,newPassword:f.password})}}}]),angular.module("scrollstoolboxApp").service("socket",["$rootScope",function(a){var b;return b="undefined"!=typeof io?io.connect():{on:function(){},emit:function(){}},{on:function(c,d){b.on(c,function(){var c=arguments;a.$apply(function(){d.apply(b,c)})})},emit:function(c,d,e){b.emit(c,d,function(){var c=arguments;a.$apply(function(){e&&e.apply(b,c)})})}}}]),angular.module("scrollstoolboxApp").controller("AccountCtrl",["$scope","$location","user",function(a,b,c){a.user=c.get(),a.$watch("user.authed",function(){a.user.authed||b.path("/")}),a.$watch("user.email",function(){a.emailEdited=a.user.email}),a.$watch("user.inGameName",function(){a.inGameNameEdited=a.user.inGameName}),a.edit=function(b){a[b+"Editing"]=!0},a.close=function(b){a[b+"Editing"]=!1,a[b+"Edited"]=a.user[b]},a.save=function(b){a.user[b]=a[b+"Edited"],c.update(),a.close(b)}}]),angular.module("scrollstoolboxApp").controller("ForgotPasswordCtrl",["$scope","$location","user",function(a,b,c){a.user=c.get(),a.$watch("user.authed",function(){a.user.authed&&b.path("/account")}),a.email="",a.resetPassword=function(){a.user=c.forgotPassword(a.email)}}]),angular.module("scrollstoolboxApp").controller("FaqCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("scrollstoolboxApp").service("cards",["$http","$rootScope","socket","user",function(a,b,c,d){function e(a){var b=["Common","Uncommon","Rare"];for(var c in a)a[c].price.median=Math.floor((a[c].price.high+a[c].price.low)/2),a[c].resource=a[c].card.costenergy?"Energy":a[c].card.costgrowth?"Growth":"Order",a[c].card.rarity=b[a[c].card.rarity];return a}function f(){var a=0;for(var b in h.data)h.data[b].owned=0,a++;a&&i.owned&&i.owned.forEach(function(a){for(var b in a)a.hasOwnProperty(b)&&"undefined"!=typeof a[b]&&(-1!==b.indexOf("Override")?h.data[a.name].price[b]=a[b]:h.data[a.name][b]=a[b])})}var g={error:!1,data:{},owned:[]},h=angular.copy(g),i=d.get();return c.on("user:registered",f),c.on("user:login",f),c.on("cards:all",function(a){h.data=e(a),f()}),c.on("card:saved",function(){}),{get:function(){return c.emit("cards:all"),h},save:function(a){return c.emit("card:save",{name:a.card.name,owned:a.owned,buyOverride:a.price.buyOverride,sellOverride:a.price.sellOverride,alwaysSell:a.alwaysSell,alwaysBuy:a.alwaysBuy}),h}}}]),angular.module("scrollstoolboxApp").controller("CollectionCtrl",function(){}),angular.module("scrollstoolboxApp").filter("price",function(){return function(a){var b="";return a&&(b=a.low===a.high?a.low:a.low+"-"+a.high),b}}),angular.module("scrollstoolboxApp").directive("ownedColor",function(){return{link:function(a,b,c){a.$watch(c.ownedColor,function(a){3>a?$(b).addClass("owned-colors-missing"):3===a?$(b).addClass("owned-colors-playset"):a>3&&$(b).addClass("owned-colors-extras")})}}}),angular.module("scrollstoolboxApp").directive("rarityColor",function(){return{link:function(a,b,c){a.$watch(c.rarityColor,function(a){a&&$(b).addClass("rarity-"+a.toLowerCase())})}}}),angular.module("scrollstoolboxApp").directive("factionColor",function(){return{link:function(a,b,c){a.$watch(c.factionColor,function(a){a&&$(b).addClass("faction-"+a.toLowerCase())})}}}),angular.module("scrollstoolboxApp").directive("imagePopup",function(){return{link:function(a,b,c){a.$watch(c.imagePopup,function(a){a&&$(b).popover({html:!0,content:'<img src="'+a+'" />',trigger:"hover",placement:"right",container:".image-popup-container"})})}}}),angular.module("scrollstoolboxApp").controller("CollectionGoldCtrl",["$scope","cards",function(a,b){a.data=b.get(),a.playsetGold=function(){var b=0,c=0;for(var d in a.data.data)a.data.data[d].owned<3&&(b+=a.data.data[d].price.low*(3-a.data.data[d].owned),c+=a.data.data[d].price.high*(3-a.data.data[d].owned));return{low:b,high:c}},a.sellGold=function(){var b=0,c=0;for(var d in a.data.data)a.data.data[d].owned>3&&(b+=a.data.data[d].price.low*(a.data.data[d].owned-3),c+=a.data.data[d].price.high*(a.data.data[d].owned-3));return{low:b,high:c}},a.binderGold=function(){var b=0,c=0;for(var d in a.data.data)b+=a.data.data[d].price.low*a.data.data[d].owned,c+=a.data.data[d].price.high*a.data.data[d].owned;return{low:b,high:c}}}]),angular.module("scrollstoolboxApp").directive("selectOnClick",function(){return function(a,b){b.click(function(){b.select()})}}),angular.module("scrollstoolboxApp").controller("TableCtrl",["$scope","cards",function(a,b){a.data=b.get(),a.generateImagePath=function(a){return a?"/img/scrolls-cards/"+a.toLowerCase().replace(/ /g,"").replace(/'/g,"")+".png":void 0},a.save=function(c){b.save(a.data.data[c])},a.tabIndex=function(b,c){return a.countCards()*c+b},a.countCards=function(){if(a.numCards)return a.numCards;var b,c=0;for(b in a.data.data)c++;return a.numCards=c,a.numCards},a.total=function(b){var c=0,d=0;for(var e in a.data.data)a.data.data[e].resource.toLowerCase()===b||"all"===b?c+=a.data.data[e].owned||0:"missing"===b&&a.data.data[e].owned<3?c+=3-a.data.data[e].owned||0:"duplicate"===b&&a.data.data[e].owned>3&&(c+=a.data.data[e].owned-3),d++;return c},a.tableView="all",a.showOrder=!0,a.showEnergy=!0,a.showGrowth=!0,a.inFiltered=function(b){return a.search&&b?-1===b.toLowerCase().indexOf(a.search.toLowerCase())?!1:!0:!0}}]),angular.module("scrollstoolboxApp").controller("WtswtbCtrl",["$scope","cards","socket",function(a,b,c){function d(){a.wtb=a.buyPrependText,a.wts=a.sellPrependText;for(var b in a.data.data)if(a.data.data.hasOwnProperty(b)&&b){var c,d,e=a.data.data[b];e.price.buyOverride?c=e.price.buyOverride:(c=Number(e.price[a.buyAt]),c+=Number(a.buyModifier)),e.price.sellOverride?d=Number(e.price.sellOverride):(d=Number(e.price[a.sellAt]),d+=Number(a.sellModifier)),e.owned<3&&("Common"===e.card.rarity&&a.buyCommon||"Uncommon"===e.card.rarity&&a.buyUncommon||"Rare"===e.card.rarity&&a.buyRare)&&(a.wtb.length>a.buyPrependText.length&&(a.wtb+=a.separator),a.wtb+=3-e.owned+"x "+b+" ("+c+"g)"),e.owned>3&&("Common"===e.card.rarity&&a.sellCommon||"Uncommon"===e.card.rarity&&a.sellUncommon||"Rare"===e.card.rarity&&a.sellRare)&&(a.wts.length>a.sellPrependText.length&&(a.wts+=a.separator),a.wts+=e.owned-3+"x "+b+" ("+d+"g)")}}a.data=b.get(),a.buyPrependText="WTB >>> ",a.sellPrependText="WTS >>> ",a.separator=" // ",a.tableView="all",a.buyAt="low",a.sellAt="high",a.buyModifier="+0",a.sellModifier="+0",a.buyCommon=!0,a.buyUncommon=!0,a.buyRare=!0,a.sellCommon=!0,a.sellUncommon=!0,a.sellRare=!0,a.showOrder=!0,a.showEnergy=!0,a.showGrowth=!0,a.wtb="",a.wts="",c.on("card:saved",d),c.on("user:login",d),c.on("cards:all",d),a.$watch("separator + buyPrependText + sellPrependText + buyModifier + sellModifier + buyAt + sellAt + buyCommon + buyUncommon + buyRare + sellCommon + sellUncommon + sellRare",d)}]),angular.module("scrollstoolboxApp").controller("LoggedInCtrl",["$scope","user",function(a,b){a.userData=b.get()}]);